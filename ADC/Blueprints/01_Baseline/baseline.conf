########################################################################################################
# Initialization Area
#
# Customer Name for use in CG and Profile Names --> $customername$
# Domain Suffix for Use in Probes and Basicservices --> $domain-suffix$
# DC Server IP 1 --> $dc-server01-ip$
# DC Server IP 2 --> $dc-server02-ip$
# DC Server Name 1 --> $dc-server01-name$
# DC Server Name 2 --> $dc-server02-name$
# Radius Server IP 1 --> $radius-server01-ip$
# Radius Server IP 2 --> $radius-server02-ip$
# Radius Server Name 1 --> $radius-server01-name$
# Radius Server Name 2 --> $radius-server02-name$
# syslog log level --> $syslog-loglevel$ (ALERT CRITICAL ERROR WARNING NOTICE INFORMATIONAL DEBUG)
# syslog protocol --> $syslog-protocol$
# syslog port --> $syslog-port$
# syslog ip --> $syslog-ip$
#
#
#
########################################################################################################

# Set Timezone to CET-Europe/Berlin
set ns param -timezone "GMT+01:00-CET-Europe/Berlin"

# Disable Modes
disable ns mode L2 L3 USIP CKA TCPB MBF SRADV DRADV IRADV SRADV6 DRADV6 BridgeBPDUs Mediaclassification ULFD

# Disable Features
disable ns feature WL SP CS CR SC CMP PQ GSLB HDOSP push CF IC SSLVPN AAA OSPF RIP BGP  IPv6PT AppFw HTMLInjection AppFlow CloudBridge ISIS CH AppQoE RISE ContentAccelerator FEO LSN RDPProxy Rep VideoOptimization AdaptiveTCP CQA CI

# Enable Features
enable ns feature LB SSL RESPONDER REWRITE 

# Add Additional System Admin User
add system user additionaladmin -externalAuth DISABLED -timeout 900

# Configure Security Options for system users
set system user nsroot -externalAuth DISABLED -timeout 900

# Enable SSL Profile Use
set ssl parameter -defaultProfile ENABLED -force

# Add and configure Cipher Group for FE TLS 1.0, 1.1 and 1.2 use
add ssl cipher ssl_cg_fe_$customername$_TLS1012_202003
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-GCM-SHA384 -cipherPriority 1
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-GCM-SHA256 -cipherPriority 2
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-SHA384 -cipherPriority 3
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-SHA256 -cipherPriority 4
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-ECDSA-AES256-SHA -cipherPriority 5
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-ECDSA-AES128-SHA -cipherPriority 6
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES256-GCM-SHA384 -cipherPriority 7
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES128-GCM-SHA256 -cipherPriority 8
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES-256-SHA384 -cipherPriority 9
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES-128-SHA256 -cipherPriority 10
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-RSA-AES256-SHA -cipherPriority 11
bind ssl cipher ssl_cg_fe_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-RSA-AES128-SHA -cipherPriority 12

# Add and configure Cipher Group for FE TLS 1.2 only use
add ssl cipher ssl_cg_fe_$customername$_TLS12_202003
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-GCM-SHA384 -cipherPriority 1
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-GCM-SHA256 -cipherPriority 2
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-SHA384 -cipherPriority 3
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-SHA256 -cipherPriority 4
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES256-GCM-SHA384 -cipherPriority 7
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES128-GCM-SHA256 -cipherPriority 8
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES-256-SHA384 -cipherPriority 9
bind ssl cipher ssl_cg_fe_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES-128-SHA256 -cipherPriority 10

# Add and configure Cipher Group for FE TLS 1.2 and 1.3 use
add ssl cipher ssl_cg_fe_$customername$_TLS1213_202003
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.3-CHACHA20-POLY1305-SHA256 -cipherPriority 1
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.3-AES256-GCM-SHA384 -cipherPriority 2
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.3-AES128-GCM-SHA256 -cipherPriority 3
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-GCM-SHA384 -cipherPriority 4
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-GCM-SHA256 -cipherPriority 5
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.2-ECDHE-RSA-AES256-GCM-SHA384 -cipherPriority 6
bind ssl cipher ssl_cg_fe_$customername$_TLS1213_202003 -cipherName TLS1.2-ECDHE-RSA-AES128-GCM-SHA256 -cipherPriority 7

# Add and configure Cipher Group for FE TLS 1.3 only use
add ssl cipher ssl_cg_fe_$customername$_TLS13_202003
bind ssl cipher ssl_cg_fe_$customername$_TLS13_202003 -cipherName TLS1.3-CHACHA20-POLY1305-SHA256 -cipherPriority 1
bind ssl cipher ssl_cg_fe_$customername$_TLS13_202003 -cipherName TLS1.3-AES256-GCM-SHA384 -cipherPriority 2
bind ssl cipher ssl_cg_fe_$customername$_TLS13_202003 -cipherName TLS1.3-AES128-GCM-SHA256 -cipherPriority 3

# Add and configure Cipher Group for BE TLS 1.0, 1.1 and 1.2 use
add ssl cipher ssl_cg_be_$customername$_TLS1012_202003
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-GCM-SHA384 -cipherPriority 1
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-GCM-SHA256 -cipherPriority 2
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-SHA384 -cipherPriority 3
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-SHA256 -cipherPriority 4
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-ECDSA-AES256-SHA -cipherPriority 5
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-ECDSA-AES128-SHA -cipherPriority 6
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES256-GCM-SHA384 -cipherPriority 7
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES128-GCM-SHA256 -cipherPriority 8
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES-256-SHA384 -cipherPriority 9
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1.2-ECDHE-RSA-AES-128-SHA256 -cipherPriority 10
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-RSA-AES256-SHA -cipherPriority 11
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1-ECDHE-RSA-AES128-SHA -cipherPriority 12
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1-AES-256-CBC-SHA -cipherPriority 13
bind ssl cipher ssl_cg_be_$customername$_TLS1012_202003 -cipherName TLS1-AES-128-CBC-SHA -cipherPriority 14

# Add and configure Cipher Group for BE TLS 1.2 only use
add ssl cipher ssl_cg_be_$customername$_TLS12_202003
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-GCM-SHA384 -cipherPriority 1
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-GCM-SHA256 -cipherPriority 2
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES256-SHA384 -cipherPriority 3
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-ECDSA-AES128-SHA256 -cipherPriority 4
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES256-GCM-SHA384 -cipherPriority 7
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES128-GCM-SHA256 -cipherPriority 8
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES-256-SHA384 -cipherPriority 9
bind ssl cipher ssl_cg_be_$customername$_TLS12_202003 -cipherName TLS1.2-ECDHE-RSA-AES-128-SHA256 -cipherPriority 10

# Add and configure SSL Profile for FE TLS 1.0, 1.1 and 1.2 use
add ssl profile ssl_prof_fe_$customername$_TLS1012_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS1012_202003 -cipherName ssl_cg_fe_$customername$_TLS1012_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS1012_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.0, 1.1 and 1.2 use with client cert authentication enabled
add ssl profile ssl_prof_fe_$customername$_TLS1012_CCert_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -clientAuth ENABLED -clientCert Mandatory -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS1012_CCert_202003 -cipherName ssl_cg_fe_$customername$_TLS1012_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS1012_CCert_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.0, 1.1 and 1.2 use with SNI enabled
add ssl profile ssl_prof_fe_$customername$_TLS1012_SNI_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -SNIEnable ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS1012_SNI_202003 -cipherName ssl_cg_fe_$customername$_TLS1012_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS1012_SNI_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.2 only use
add ssl profile ssl_prof_fe_$customername$_TLS12_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -tls1 DISABLED -tls11 DISABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS12_202003 -cipherName ssl_cg_fe_$customername$_TLS12_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS12_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.2 only use with client cert authentication enabled
add ssl profile ssl_prof_fe_$customername$_TLS12_CCert_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -clientAuth ENABLED -clientCert Mandatory -tls1 DISABLED -tls11 DISABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS12_CCert_202003 -cipherName ssl_cg_fe_$customername$_TLS12_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS12_CCert_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.2 only use with SNI enabled
add ssl profile ssl_prof_fe_$customername$_TLS12_SNI_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -tls1 DISABLED -tls11 DISABLED -SNIEnable ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS12_SNI_202003 -cipherName ssl_cg_fe_$customername$_TLS12_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS12_SNI_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.2 and 1.3 use
add ssl profile ssl_prof_fe_$customername$_TLS1213_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -tls1 DISABLED -tls11 DISABLED -tls13 ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS1213_202003 -cipherName ssl_cg_fe_$customername$_TLS1213_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS1213_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.2 and 1.3 use with SNI enabled
add ssl profile ssl_prof_fe_$customername$_TLS1213_CCert_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -clientAuth ENABLED -clientCert Mandatory -tls1 DISABLED -tls11 DISABLED -tls13 ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS1213_CCert_202003 -cipherName ssl_cg_fe_$customername$_TLS1213_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS1213_CCert_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.2 and 1.3 use with client cert authentication enabled
add ssl profile ssl_prof_fe_$customername$_TLS1213_SNI_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -tls1 DISABLED -tls11 DISABLED -tls13 ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS1213_SNI_202003 -cipherName ssl_cg_fe_$customername$_TLS1213_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS1213_SNI_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.3 only use
add ssl profile ssl_prof_fe_$customername$_TLS13_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -tls1 DISABLED -tls11 DISABLED -tls12 DISABLED -tls13 ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS13_202003 -cipherName ssl_cg_fe_$customername$_TLS13_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS13_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.3 only use with client cert authentication enabled
add ssl profile ssl_prof_fe_$customername$_TLS13_CCert_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -clientAuth ENABLED -clientCert Mandatory -tls1 DISABLED -tls11 DISABLED -tls12 DISABLED -tls13 ENABLED -SNIEnable ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS13_CCert_202003 -cipherName ssl_cg_fe_$customername$_TLS13_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS13_CCert_202003 -cipherName DEFAULT

# Add and configure SSL Profile for FE TLS 1.3 only use with SNI enabled
add ssl profile ssl_prof_fe_$customername$_TLS13_SNI_202003 -eRSA DISABLED -sessReuse ENABLED -sessTimeout 120 -tls1 DISABLED -tls11 DISABLED -tls12 DISABLED -tls13 ENABLED -SNIEnable ENABLED -denySSLReneg NONSECURE
bind ssl profile ssl_prof_fe_$customername$_TLS13_SNI_202003 -cipherName ssl_cg_fe_$customername$_TLS13_202003 -cipherPriority 1
unbind ssl profile ssl_prof_fe_$customername$_TLS13_SNI_202003 -cipherName DEFAULT

# Add and configure SSL Profile for BE TLS 1.2 only use
add ssl profile ssl_prof_be_$customername$_TLS12_202003 -sslProfileType BackEnd -eRSA DISABLED -sessReuse ENABLED -sessTimeout 300 -tls1 DISABLED -tls11 DISABLED
bind ssl profile ssl_prof_be_$customername$_TLS12_202003 -cipherName ssl_cg_be_$customername$_TLS12_202003 -cipherPriority 1
unbind ssl profile ssl_prof_be_$customername$_TLS12_202003 -cipherName DEFAULT_BACKEND

# Add and configure SSL Profile for BE TLS 1.0, 1.1 and 1.2 use
add ssl profile ssl_prof_be_$customername$_TLS1012_202003 -sslProfileType BackEnd -eRSA DISABLED -sessReuse ENABLED -sessTimeout 300
bind ssl profile ssl_prof_be_$customername$_TLS1012_202003 -cipherName ssl_cg_be_$customername$_TLS1012_202003 -cipherPriority 1
unbind ssl profile ssl_prof_be_$customername$_TLS1012_202003 -cipherName DEFAULT_BACKEND

# Rewrite Actions and Policies for htts(s) Security Settings
add rewrite action rw_act_http-header_content-sec insert_http_header Content-Security-Policy "\"default-src \'self\' ; script-src \'self\' \'unsafe-inline\' \'unsafe-eval\' ; style-src \'self\' \'unsafe-inline\' \'unsafe-eval\'; img-src \'self\' data:\""
add rewrite action rw_act_http-header_XSS insert_http_header X-Xss-Protection "\"1; mode=block\""
add rewrite action rw_act_http-header_Referrer insert_http_header Referrer-Policy "\"SAME-ORIGIN\""
add rewrite action rw_act_http-header_X_Frame insert_http_header X-Frame-Options "\"SAMEORIGIN\""
add rewrite action rw_act_http-header_Expect_CT insert_http_header Expect-CT "\"enforce,max-age=30\""
add rewrite action rw_act_http-header_content-sec_ctxgw insert_http_header Content-Security-Policy "\"default-src \'self\' ; script-src \'self\' \'unsafe-inline\' \'unsafe-eval\' ; style-src \'self\' \'unsafe-inline\' \'unsafe-eval\'; img-src \'self\' http://localhost:* data:;\" "
add rewrite action rw_act_http-header_Xcontent insert_http_header X-Content-Type-Options "\"nosniff\""
add rewrite action rw_act_http-header_hsts insert_http_header Strict-Transport-Security "\"max-age=157680000\""

add rewrite policy rw_pol_http-header_content-sec "HTTP.RES.HEADER(\"Content-Security-Polic\").EXISTS.NOT" rw_act_http-header_content-sec
add rewrite policy rw_pol_http-header_XSS "HTTP.RES.HEADER(\"X-Xss-Protection\").EXISTS.NOT" rw_act_http-header_XSS
add rewrite policy rw_pol_http-header_Referrer "HTTP.RES.HEADER(\"Referrer-Policyn\").EXISTS.NOT" rw_act_http-header_Referrer
add rewrite policy rw_pol_http-header_X_Frame "HTTP.RES.HEADER(\"X-Frame-Options\").EXISTS.NOT" rw_act_http-header_X_Frame
add rewrite policy rw_pol_http-header_Expect_CT "HTTP.RES.HEADER(\"Expect-CT\").EXISTS.NOT" rw_act_http-header_Expect_CT
add rewrite policy rw_pol_http-header_Xcontent "HTTP.RES.HEADER(\"X-Content-Type-Options\").EXISTS.NOT" rw_act_http-header_Xcontent
add rewrite policy rw_pol_http-header_content-sec_ctxgw "HTTP.RES.HEADER(\"Content-Security-Policy\").EXISTS.NOT" rw_act_http-header_content-sec_ctxgw
add rewrite policy rw_pol_http-header_hsts "http.RES.HEADER(\"Strict-Transport-Security\").EXISTS.NOT" rw_act_http-header_hsts

# Add Responder Action and Policy http redirect
add responder action resp_act_https_redirect redirect "\"https://\"+HTTP.REQ.HEADER(\"Host\").HTTP_HEADER_SAFE+HTTP.REQ.URL.PATH_AND_QUERY.HTTP_URL_SAFE" -responseStatusCode 302
add responder policy resp_pol_https_redirect HTTP.REQ.IS_VALID resp_act_https_redirect RESET

# Add DNS NoCache Profile
add dns profile dns_prof_$customername$ -cacheRecords DISABLED -cacheNegativeResponses DISABLED -dropMultiQueryRequest ENABLED

# Configure LB Monitors to use with Basic Services
add lb monitor lb_mon_dns_$domain-suffix$ DNS -query domaincontroller01.$domain-suffix$ -queryType Address -LRTM DISABLED -IPAddress $dc-server01-ip$
add lb monitor lb_mon_ldap-tls_$domain-suffix$ LDAP -scriptName nsldap.pl -dispatcherIP 127.0.0.1 -dispatcherPort 3013 -LRTM DISABLED -secure YES -baseDN svc_ldap@$domain-suffix$ -bindDN "dc=domain,dc=local"
add lb monitor lb_mon_radius_$domain-suffix$ RADIUS -respCode 2 -userName RadiusUser -password RADIUSPW -encrypted -encryptmethod ENCMTHD_3 -radKey RADIUSKEY -encrypted -encryptmethod ENCMTHD_3 -LRTM DISABLED
# TBD: nsldaps.pl hochladen
# add lb monitor lb_mon_ldaps_$domain-suffix$ 

# Add LoadBalancing Servers for basic Services
add server lb_srv_$dc-server01-name$.$domain-suffix$ $dc-server01-ip$
add server lb_srv_$dc-server02-name$.$domain-suffix$ $dc-server02-ip$

add server lb_srv_$radius-server01-name$.$domain-suffix$ $radius-server01-ip$
add server lb_srv_$radius-server02-name$.$domain-suffix$ $radius-server02-ip$

# Add LoadBalancing Service Groups for basic Services
add serviceGroup lb_sg_basicservice_dns_53 DNS -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport NO -cltTimeout 120 -svrTimeout 120 -CKA NO -TCPB NO -CMP NO
bind serviceGroup lb_sg_basicservice_dns_53 lb_srv_$dc-server01-name$.$domain-suffix$ 53
bind serviceGroup lb_sg_basicservice_dns_53 lb_srv_$dc-server02-name$.$domain-suffix$ 53
bind serviceGroup lb_sg_basicservice_dns_53 -monitorName lb_mon_dns_$domain-suffix$

add serviceGroup lb_sg_basicservice_ldaps_636 SSL_TCP -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -cltTimeout 9000 -svrTimeout 9000 -CKA NO -TCPB NO -CMP NO
bind serviceGroup lb_sg_basicservice_ldaps_636 lb_srv_$dc-server01-name$.$domain-suffix$ 636
bind serviceGroup lb_sg_basicservice_ldaps_636 lb_srv_$dc-server02-name$.$domain-suffix$ 636
bind ssl vserver lb_vs_basicservice_ldaps_636 -certkeyName ssl_cert_wildcard.$domain-suffix$
bind serviceGroup lb_sg_basicservice_ldaps_636 -monitorName lb_mon_ldaps_$domain-suffix$
set ssl serviceGroup lb_sg_basicservice_ldaps_636 -sslProfile ssl_prof_be_$customername$_TLS12_202003

add serviceGroup lb_sg_basicservice_ldap-tls_389 TCP -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -cltTimeout 9000 -svrTimeout 9000 -CKA NO -TCPB NO -CMP NO
bind serviceGroup lb_sg_basicservice_ldap-tls_389 lb_srv_$dc-server01-name$.$domain-suffix$ 389
bind serviceGroup lb_sg_basicservice_ldap-tls_389 lb_srv_$dc-server02-name$.$domain-suffix$ 389
bind serviceGroup lb_sg_basicservice_ldap-tls_389 -monitorName tcp

add serviceGroup lb_sg_basicservice_radius_1812 RADIUS -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport NO -cltTimeout 120 -svrTimeout 120 -CKA NO -TCPB NO -CMP NO
bind serviceGroup lb_sg_basicservice_radius_1812 lb_srv_$radius-server01-name$.$domain-suffix$ 1812
bind serviceGroup lb_sg_basicservice_radius_1812 lb_srv_$radius-server02-name$.$domain-suffix$ 1812
bind serviceGroup lb_sg_basicservice_radius_1812 -monitorName tcp

# Add LoadBalancing vServer for basic Services
add lb vserver lb_vs_basicservice_ldap-tls_389 TCP 9.9.9.9 389 -persistenceType SOURCEIP -cltTimeout 9000
bind lb vserver lb_vs_basicservice_ldap-tls_389 lb_sg_basicservice_ldap-tls_389

add lb vserver lb_vs_basicservice_ldaps_636 SSL_TCP 9.9.9.9 636 -persistenceType SOURCEIP -cltTimeout 9000
bind lb vserver lb_vs_basicservice_ldaps_636 lb_sg_basicservice_ldaps_636
set ssl vserver lb_vs_basicservice_ldaps_636 -sslProfile ns_default_ssl_profile_frontend

add lb vserver lb_vs_basicservice_dns_53 DNS 9.9.9.9 53 -persistenceType SOURCEIP -cltTimeout 9000 -dnsProfileName dns_prof_$customername$
bind lb vserver lb_vs_basicservice_dns_53 lb_sg_basicservice_dns_53

add lb vserver lb_vs_basicservice_radius_1812 RADIUS 9.9.9.9 1812 -persistenceType SOURCEIP -cltTimeout 9000
bind lb vserver lb_vs_basicservice_radius_1812 lb_sg_basicservice_radius_1812

# Set System DNS vServer
add dns nameServer lb_vs_basicservice_dns_53

# Add http Profile
add ns httpProfile http_prof_$customername$ -dropInvalReqs ENABLED -markHttp09Inval ENABLED -markConnReqInval ENABLED -webLog DISABLED

# Add TCP Profile
add ns tcpProfile tcp_prof_$customername$ -WS ENABLED -SACK ENABLED -WSVal 8 -mss 1460 -initialCwnd 10 -oooQSize 300 -bufferSize 131072 -flavor BIC -sendBuffsize 131072 -rstMaxAck ENABLED -spoofSynDrop DISABLED -frto ENABLED -fack ENABLED -nagle ENABLED -dynamicReceiveBuffering ENABLED -DropHalfClosedConnOnTimeout ENABLED -DropEstConnOnTimeout ENABLED

# Secure the standard internal sevices - Manually added Services (Management SNIPS) have to be secured additionally
set ssl service nsrnatsip-127.0.0.1-5061 -sslProfile ssl_prof_fe_$customername$_TLS12_202003
set ssl service nskrpcs-127.0.0.1-3009 -sslProfile ssl_prof_fe_$customername$_TLS12_202003
set ssl service nshttps-::1l-443 -sslProfile ssl_prof_fe_$customername$_TLS12_202003
set ssl service nsrpcs-::1l-3008 -sslProfile ssl_prof_fe_$customername$_TLS12_202003
set ssl service nshttps-127.0.0.1-443 -sslProfile ssl_prof_fe_$customername$_TLS12_202003
set ssl service nsrpcs-127.0.0.1-3008 -sslProfile ssl_prof_fe_$customername$_TLS12_202003

add audit syslogAction aud_syslog_srv_dingens_$syslog-protocol$ $syslog-ip$ -logLevel EMERGENCY ALERT CRITICAL ERROR WARNING NOTICE INFORMATIONAL DEBUG -dateFormat DDMMYYYY -tcp ALL -acl ENABLED -timeZone LOCAL_TIME -userDefinedAuditlog YES -appflowExport ENABLED -lsn ENABLED -alg ENABLED -subscriberLog ENABLED -dns ENABLED -sslInterception ENABLED -urlFiltering ENABLED
add audit syslogPolicy aud_syslog_pol_dingens_$syslog-protocol$ true aud_syslog_srv_dingens_$syslog-protocol$

# Save Configuration
save ns config