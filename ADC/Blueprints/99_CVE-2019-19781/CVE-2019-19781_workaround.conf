# Single Instance
enable ns feature responder
add responder action resp_act_ctx267027 respondwith "\"HTTP/1.1 403 Forbidden\r\n\r\n\""
add responder policy resp_pol_ctx267027 "HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/vpns/\") && (!CLIENT.SSLVPN.IS_SSLVPN || HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/../\"))" resp_act_ctx267027
bind responder global resp_pol_ctx267027 1 END -type REQ_OVERRIDE
save config 
shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "echo 'nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0' >> /nsconfig/rc.netscaler"
reboot

# HA Pair
## Primary
enable ns feature responder
add responder action resp_act_ctx267027 respondwith "\"HTTP/1.1 403 Forbidden\r\n\r\n\""
add responder policy resp_pol_ctx267027 "HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/vpns/\") && (!CLIENT.SSLVPN.IS_SSLVPN || HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/../\"))" resp_act_ctx267027
bind responder global resp_pol_ctx267027 1 END -type REQ_OVERRIDE
save config 
shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "echo 'nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0' >> /nsconfig/rc.netscaler"
reboot

## Secondary
shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "echo 'nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0' >> /nsconfig/rc.netscaler"
reboot

# Cluster
## Cluster-IP
enable ns feature responder
add responder action resp_act_ctx267027 respondwith "\"HTTP/1.1 403 Forbidden\r\n\r\n\""
add responder policy resp_pol_ctx267027 "HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/vpns/\") && (!CLIENT.SSLVPN.IS_SSLVPN || HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/../\"))" resp_act_ctx267027
bind responder global resp_pol_ctx267027 1 END -type REQ_OVERRIDE
save config 
shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "echo 'nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0' >> /nsconfig/rc.netscaler"
reboot

## Each Node
shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "echo 'nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0' >> /nsconfig/rc.netscaler"
reboot

## Admin Partition
switch ns partition default
enable ns feature responder
add responder action resp_act_ctx267027 respondwith "\"HTTP/1.1 403 Forbidden\r\n\r\n\""
add responder policy resp_pol_ctx267027 "HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/vpns/\") && (!CLIENT.SSLVPN.IS_SSLVPN || HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/../\"))" resp_act_ctx267027
bind responder global resp_pol_ctx267027 1 END -type REQ_OVERRIDE
save config
shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "echo 'nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0' >> /nsconfig/rc.netscaler"
reboot

# Revert Changes
unbind responder global resp_pol_ctx267027
rm responder policy resp_pol_ctx267027
rm responder action resp_act_ctx267027
save config

shell nsapimgr_wr.sh -ys skip_systemaccess_policyeval=0
shell "sed -i '' '/skip_systemaccess_policyeval=0/d' /nsconfig/rc.netscaler"
reboot



### NOTROBIN --> https://www.fireeye.com/blog/threat-research/2020/01/vigilante-deploying-mitigation-for-citrix-netscaler-vulnerability-while-maintaining-backdoor.html
HTTP URL prefix --> hxxps://95[.]179.163.186/wp-content/uploads/2018/09/
Directory --> /var/nstmp/.nscache
Filename --> /var/nstmp/.nscache/httpd
Directory --> /tmp/.init
Filename --> /tmp/.init/httpd
Crontab entry --> /var/nstmp/.nscache/httpd
Listening UDP port --> 18634
Remote IP --> 95.179.163[.]186
Remote IP --> 80.240.31[.]218
Domain --> vilarunners[.]cat