### CISAGOV Tool https://github.com/cisagov/check-cve-2019-19781

### http://deyda.net/index.php/en/2020/01/15/checklist-for-citrix-adc-cve-2019-19781/
# Check for xml files. No putput / ERROR --> No sign of attack here
shell ls /netscaler/portal/templates/*.xml

# Check for template directory. No putput / ERROR --> No sign of attack here
shell ls /var/tmp/netscaler/portal/templates

# This directory should not exist or only contain XML files from users you know.
shell ls /var/vpn/bookmark/*.xml

# There may also be entries in the bash.logs when attacks occur. We are looking for the user nobody here, since these are his rights if he comes through Apache.
shell cat /var/log/bash.log | grep nobody
shell gzcat /var/log/bash.*.gz | grep nobody

# Furthermore, attacks leave entries in the Apache httpaccess log files.
shell cat /var/log/httpaccess.log | grep vpns | grep xml
shell cat /var/log/httpaccess.log | grep "/\.\./"
shell gzcat /var/log/httpaccess.log.*.gz | grep vpns | grep xml
shell gzcat /var/log/httpaccess.log.*.gz | grep "/\.\./"

# Check crontab
shell cat /etc/crontab

# Check for added users
shell cat /etc/passwd

# Check if added users are running cronjobs (e.g. user nobody)
crontab -u nobody -l

# check for added perl or python scripts
shell ps -aux | grep python
shell ps -aux | grep perl

# Check for crypto mining --> Only NSPPExx should be at 100%
shell top -n 10

### NOTROBIN --> https://www.fireeye.com/blog/threat-research/2020/01/vigilante-deploying-mitigation-for-citrix-netscaler-vulnerability-while-maintaining-backdoor.html
HTTP URL prefix --> hxxps://95[.]179.163.186/wp-content/uploads/2018/09/
Directory --> /var/nstmp/.nscache
Filename --> /var/nstmp/.nscache/httpd
Directory --> /tmp/.init
Filename --> /tmp/.init/httpd
Crontab entry --> /var/nstmp/.nscache/httpd
Listening UDP port --> 18634
Remote IP --> 95.179.163[.]186
Remote IP --> 80.240.31[.]218
Domain --> vilarunners[.]cat